<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Poblar Firebase - AtlasCine</title>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: #0a0a0a;
            color: #fff;
            padding: 40px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .container {
            background: rgba(20, 20, 30, 0.8);
            border-radius: 16px;
            padding: 32px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        h1 {
            color: #e50914;
            margin-bottom: 24px;
        }
        button {
            background: linear-gradient(135deg, #e50914 0%, #b20710 100%);
            color: white;
            border: none;
            padding: 14px 32px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin: 10px 10px 10px 0;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(229, 9, 20, 0.4);
        }
        button:disabled {
            background: #555;
            cursor: not-allowed;
        }
        #log {
            background: #000;
            padding: 20px;
            border-radius: 8px;
            margin-top: 24px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 500px;
            overflow-y: auto;
            border: 1px solid rgba(229, 9, 20, 0.3);
        }
        .success { color: #46d369; }
        .error { color: #e50914; }
        .info { color: #0ea5e9; }
        .warning { color: #fbbf24; }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin: 24px 0;
        }
        .stat-card {
            background: rgba(229, 9, 20, 0.1);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid rgba(229, 9, 20, 0.3);
        }
        .stat-number {
            font-size: 32px;
            font-weight: 800;
            color: #e50914;
        }
        .stat-label {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.7);
            margin-top: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üî• Poblar Firebase - AtlasCine Database</h1>

        <div class="stats">
            <div class="stat-card">
                <div class="stat-number" id="totalItems">0</div>
                <div class="stat-label">Total Items</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="uploadedItems">0</div>
                <div class="stat-label">Subidos</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="sourcesCount">15</div>
                <div class="stat-label">Fuentes</div>
            </div>
        </div>

        <button id="uploadBtn" onclick="uploadAllToFirebase()">üì§ Subir Todo a Firebase</button>
        <button onclick="clearFirestore()">üóëÔ∏è Limpiar Firestore</button>
        <button onclick="testConnection()">üîå Probar Conexi√≥n</button>
        <button onclick="clearLog()">üßπ Limpiar Log</button>

        <div id="log"></div>
    </div>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <!-- Firebase Config -->
    <script src="js/firebase-config.js"></script>

    <!-- Database Sources -->
    <script src="js/databases/hdtoday.js"></script>
    <script src="js/databases/lodynet.js"></script>
    <script src="js/databases/aradramatv.js"></script>
    <script src="js/databases/pelisflix.js"></script>
    <script src="js/databases/vidsrc.js"></script>
    <script src="js/databases/embedsu.js"></script>
    <script src="js/databases/dramacool.js"></script>
    <script src="js/databases/asiancrush.js"></script>
    <script src="js/databases/cinecalidad.js"></script>
    <script src="js/databases/cuevana.js"></script>
    <script src="js/databases/movidy.js"></script>
    <script src="js/databases/soap2day.js"></script>
    <script src="js/databases/fmovies.js"></script>
    <script src="js/databases/primewire.js"></script>
    <script src="js/databases/yesmovies.js"></script>

    <script>
        const logDiv = document.getElementById('log');
        const uploadBtn = document.getElementById('uploadBtn');

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const span = document.createElement('div');
            span.className = type;
            span.textContent = `[${timestamp}] ${message}`;
            logDiv.appendChild(span);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function clearLog() {
            logDiv.innerHTML = '';
            log('Log limpiado', 'info');
        }

        async function testConnection() {
            log('Probando conexi√≥n con Firebase...', 'info');
            try {
                initializeFirebase();
                const db = firebase.firestore();
                await db.collection('test').doc('connection').set({
                    timestamp: new Date(),
                    message: 'Test connection'
                });
                log('‚úÖ Conexi√≥n exitosa con Firebase!', 'success');
            } catch (error) {
                log(`‚ùå Error de conexi√≥n: ${error.message}`, 'error');
            }
        }

        async function clearFirestore() {
            if (!confirm('¬øEst√°s seguro de eliminar TODA la base de datos de Firestore?')) {
                return;
            }

            log('üóëÔ∏è Eliminando contenido de Firestore...', 'warning');
            uploadBtn.disabled = true;

            try {
                initializeFirebase();
                const db = firebase.firestore();
                const snapshot = await db.collection('movies_series').get();

                const batch = db.batch();
                snapshot.docs.forEach(doc => {
                    batch.delete(doc.ref);
                });

                await batch.commit();
                log(`‚úÖ ${snapshot.size} documentos eliminados`, 'success');
                document.getElementById('uploadedItems').textContent = '0';
            } catch (error) {
                log(`‚ùå Error: ${error.message}`, 'error');
            } finally {
                uploadBtn.disabled = false;
            }
        }

        async function uploadAllToFirebase() {
            log('üöÄ Iniciando carga masiva a Firebase...', 'info');
            uploadBtn.disabled = true;

            // Combinar todas las fuentes
            const allContent = [
                ...(window.hdtodayContent || []),
                ...(window.lodynetContent || []),
                ...(window.arabdramatvContent || []),
                ...(window.pelisflixContent || []),
                ...(window.vidsrcContent || []),
                ...(window.embedsuContent || []),
                ...(window.dramacoolContent || []),
                ...(window.asiancrushContent || []),
                ...(window.cinecalidadContent || []),
                ...(window.cuevanaContent || []),
                ...(window.movidy || []),
                ...(window.soap2day || []),
                ...(window.fmovies || []),
                ...(window.primewire || []),
                ...(window.yesmovies || [])
            ];

            document.getElementById('totalItems').textContent = allContent.length;
            log(`üìä Total de items a subir: ${allContent.length}`, 'info');

            try {
                initializeFirebase();
                const db = firebase.firestore();
                let uploaded = 0;

                // Subir en lotes de 500 (l√≠mite de Firestore batch)
                const batchSize = 500;
                for (let i = 0; i < allContent.length; i += batchSize) {
                    const batch = db.batch();
                    const chunk = allContent.slice(i, i + batchSize);

                    chunk.forEach(item => {
                        const docRef = db.collection('movies_series').doc(`${item.source}_${item.id}`);
                        batch.set(docRef, {
                            ...item,
                            uploadedAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                    });

                    await batch.commit();
                    uploaded += chunk.length;
                    document.getElementById('uploadedItems').textContent = uploaded;
                    log(`‚úÖ Lote ${Math.floor(i/batchSize) + 1}: ${chunk.length} items subidos (Total: ${uploaded}/${allContent.length})`, 'success');
                }

                log('üéâ ¬°COMPLETADO! Todos los datos subidos a Firebase', 'success');
                log('üìå Puedes eliminar los archivos .js de databases/ ahora', 'warning');

            } catch (error) {
                log(`‚ùå Error: ${error.message}`, 'error');
                console.error(error);
            } finally {
                uploadBtn.disabled = false;
            }
        }

        // Auto-initialize
        window.addEventListener('load', () => {
            log('üî• Sistema listo para poblar Firebase', 'info');
            log('üìÅ Archivos de datos cargados correctamente', 'success');
        });
    </script>
</body>
</html>
